{"version":3,"sources":["../../../src/clients/user/token.ts"],"names":[],"mappings":"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","file":"token.mjs","sourcesContent":["import qs from 'qs';\n\nimport { Client, ClientOptions } from '@microsoft/teams.common/http';\n\nimport { ChannelID, TokenExchangeRequest, TokenResponse, TokenStatus } from '../../models';\nimport { ApiClientSettings, mergeApiClientSettings } from '../api-client-settings';\n\nexport type GetUserTokenParams = {\n  userId: string;\n  connectionName: string;\n  channelId?: ChannelID;\n  code?: string;\n};\n\nexport type GetUserAADTokenParams = {\n  userId: string;\n  connectionName: string;\n  resourceUrls: string[];\n  channelId: ChannelID;\n};\n\nexport type GetUserTokenStatusParams = {\n  userId: string;\n  channelId: ChannelID;\n  includeFilter: string;\n};\n\nexport type SignOutUserParams = {\n  userId: string;\n  connectionName: string;\n  channelId: ChannelID;\n};\n\nexport type ExchangeUserTokenParams = {\n  userId: string;\n  connectionName: string;\n  channelId: ChannelID;\n  exchangeRequest: TokenExchangeRequest;\n};\n\nexport const USER_TOKEN_ENDPOINTS = {\n  GET_TOKEN: 'api/usertoken/GetToken',\n  GET_AAD_TOKENS: 'api/usertoken/GetAadTokens',\n  GET_STATUS: 'api/usertoken/GetTokenStatus',\n  SIGN_OUT: 'api/usertoken/SignOut',\n  EXCHANGE: 'api/usertoken/exchange',\n};\n\nexport class UserTokenClient {\n  get http() {\n    return this._http;\n  }\n  set http(v) {\n    this._http = v;\n  }\n  protected _http: Client;\n  protected _apiClientSettings: Partial<ApiClientSettings>;\n\n  constructor(options?: Client | ClientOptions, apiClientSettings?: Partial<ApiClientSettings>) {\n    if (!options) {\n      this._http = new Client();\n    } else if ('request' in options) {\n      this._http = options;\n    } else {\n      this._http = new Client(options);\n    }\n\n    this._apiClientSettings = mergeApiClientSettings(apiClientSettings);\n  }\n\n  async get(params: GetUserTokenParams) {\n    const q = qs.stringify(params);\n    const res = await this.http.get<TokenResponse>(\n      `${this._apiClientSettings.oauthUrl}/${USER_TOKEN_ENDPOINTS.GET_TOKEN}?${q}`\n    );\n\n    return res.data;\n  }\n\n  async getAad(params: GetUserAADTokenParams) {\n    const q = qs.stringify(params);\n    const res = await this.http.post<Record<string, TokenResponse>>(\n      `${this._apiClientSettings.oauthUrl}/${USER_TOKEN_ENDPOINTS.GET_AAD_TOKENS}?${q}`,\n      params\n    );\n\n    return res.data;\n  }\n\n  async getStatus(params: GetUserTokenStatusParams) {\n    const q = qs.stringify(params);\n    const res = await this.http.get<TokenStatus[]>(\n      `${this._apiClientSettings.oauthUrl}/${USER_TOKEN_ENDPOINTS.GET_STATUS}?${q}`\n    );\n\n    return res.data;\n  }\n\n  async signOut(params: SignOutUserParams) {\n    const q = qs.stringify(params);\n    const res = await this.http.delete<void>(\n      `${this._apiClientSettings.oauthUrl}/${USER_TOKEN_ENDPOINTS.SIGN_OUT}?${q}`,\n      { data: params }\n    );\n\n    return res.data;\n  }\n\n  async exchange(params: ExchangeUserTokenParams) {\n    const q = qs.stringify({\n      userId: params.userId,\n      connectionName: params.connectionName,\n      channelId: params.channelId,\n    });\n\n    const res = await this.http.post<TokenResponse>(\n      `${this._apiClientSettings.oauthUrl}/${USER_TOKEN_ENDPOINTS.EXCHANGE}?${q}`,\n      params.exchangeRequest\n    );\n\n    return res.data;\n  }\n}\n"]}