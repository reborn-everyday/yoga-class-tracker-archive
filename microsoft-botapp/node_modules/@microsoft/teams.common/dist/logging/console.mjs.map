{"version":3,"sources":["../../src/logging/console.ts"],"names":[],"mappings":";;AAGO,MAAM,aAAiC,CAAA;AAAA,EACnC,aAAA;AAAA,EAEU,IAAA;AAAA,EACA,KAAA;AAAA,EAEF,QAAA;AAAA,EACA,OAAU,GAAA;AAAA,IACzB,KAAO,EAAA,GAAA;AAAA,IACP,IAAM,EAAA,GAAA;AAAA,IACN,IAAM,EAAA,GAAA;AAAA,IACN,KAAO,EAAA,GAAA;AAAA,IACP,KAAO,EAAA;AAAA,GACT;AAAA,EAEiB,OAAU,GAAA;AAAA,IACzB,OAAO,IAAK,CAAA,aAAA;AAAA,IACZ,MAAM,IAAK,CAAA,gBAAA;AAAA,IACX,MAAM,IAAK,CAAA,cAAA;AAAA,IACX,OAAO,IAAK,CAAA,iBAAA;AAAA,IACZ,OAAO,IAAK,CAAA;AAAA,GACd;AAAA,EAEA,WAAA,CAAY,MAAc,OAA0B,EAAA;AAClD,IAAA,IAAA,CAAK,IAAO,GAAA,IAAA;AAEZ,IAAA,MAAM,GAAM,GAAA,OAAO,OAAY,KAAA,WAAA,GAAc,SAAY,OAAQ,CAAA,GAAA;AACjE,IAAA,MAAM,cAAiB,GAAA,GAAA,EAAK,GAAO,IAAA,OAAA,EAAS,OAAW,IAAA,GAAA;AACvD,IAAA,IAAA,CAAK,QAAW,GAAA,cAAA,CAAe,cAAc,CAAA,CAAE,KAAK,IAAI,CAAA;AACxD,IAAA,IAAA,CAAK,QAAQ,aAAc,CAAA,GAAA,EAAK,SAAS,CAAA,IAAK,SAAS,KAAS,IAAA,MAAA;AAChE,IAAA,IAAA,CAAK,gBAAgB,OAAW,IAAA;AAAA,MAC9B,OAAO,IAAK,CAAA,KAAA;AAAA,MACZ,OAAS,EAAA;AAAA,KACX;AAAA;AACF,EAEA,SAAS,GAAY,EAAA;AACnB,IAAK,IAAA,CAAA,GAAA,CAAI,OAAS,EAAA,GAAG,GAAG,CAAA;AAAA;AAC1B,EAEA,QAAQ,GAAY,EAAA;AAClB,IAAK,IAAA,CAAA,GAAA,CAAI,MAAQ,EAAA,GAAG,GAAG,CAAA;AAAA;AACzB,EAEA,QAAQ,GAAY,EAAA;AAClB,IAAK,IAAA,CAAA,GAAA,CAAI,MAAQ,EAAA,GAAG,GAAG,CAAA;AAAA;AACzB,EAEA,SAAS,GAAY,EAAA;AACnB,IAAK,IAAA,CAAA,GAAA,CAAI,OAAS,EAAA,GAAG,GAAG,CAAA;AAAA;AAC1B,EAEA,SAAS,GAAY,EAAA;AACnB,IAAK,IAAA,CAAA,GAAA,CAAI,OAAS,EAAA,GAAG,GAAG,CAAA;AAAA;AAC1B,EAEA,GAAA,CAAI,UAAoB,GAAY,EAAA;AAClC,IAAI,IAAA,CAAC,KAAK,QAAU,EAAA;AAClB,MAAA;AAAA;AAGF,IAAI,IAAA,IAAA,CAAK,QAAQ,KAAK,CAAA,GAAI,KAAK,OAAQ,CAAA,IAAA,CAAK,KAAK,CAAG,EAAA;AAClD,MAAA;AAAA;AAGF,IAAA,MAAM,MAAS,GAAA,CAAC,IAAK,CAAA,OAAA,CAAQ,KAAK,CAAA,EAAG,IAAK,CAAA,IAAA,EAAM,CAAI,CAAA,EAAA,KAAA,CAAM,WAAY,EAAC,CAAG,CAAA,CAAA,CAAA;AAC1E,IAAA,MAAM,OAAO,CAAC,IAAA,CAAK,MAAM,IAAK,CAAA,eAAA,EAAiB,KAAK,SAAS,CAAA;AAE7D,IAAA,KAAA,MAAW,KAAK,GAAK,EAAA;AACnB,MAAI,IAAA,IAAA,GAAO,IAAI,MAAA,CAAO,CAAC,CAAA;AAEvB,MAAI,IAAA,OAAO,MAAM,QAAU,EAAA;AACzB,QAAA,IAAA,GAAO,IAAK,CAAA,SAAA,CAAU,CAAG,EAAA,IAAA,EAAM,CAAC,CAAA;AAAA;AAGlC,MAAA,KAAA,MAAW,IAAQ,IAAA,IAAA,CAAK,KAAM,CAAA,IAAI,CAAG,EAAA;AACnC,QAAQ,OAAA,CAAA,KAAK,CAAE,CAAA,MAAA,CAAO,IAAK,CAAA,EAAE,GAAG,IAAK,CAAA,IAAA,CAAK,EAAE,CAAA,EAAG,IAAI,CAAA;AAAA;AACrD;AACF;AACF,EAEA,KAAA,CAAM,MAAc,eAAkC,EAAA;AACpD,IAAA,MAAM,aAAgB,GAAA,aAAA;AAAA,MACpB,KAAK,aAAc,CAAA,OAAA;AAAA,MACnB,eAAiB,EAAA;AAAA,KACnB;AAEA,IAAA,OAAO,IAAI,aAAc,CAAA,CAAA,EAAG,KAAK,IAAI,CAAA,CAAA,EAAI,IAAI,CAAI,CAAA,EAAA;AAAA,MAC/C,GAAG,IAAK,CAAA,aAAA;AAAA,MACR,GAAG,eAAA;AAAA,MACH,OAAS,EAAA;AAAA,KACV,CAAA;AAAA;AAEL;AAEA,SAAS,mBAAmB,OAAiE,EAAA;AAC3F,EAAM,MAAA,QAAA,GAAW,QAAQ,KAAM,CAAA,GAAG,EAAE,GAAI,CAAA,CAAA,CAAA,KAAK,CAAE,CAAA,IAAA,EAAM,CAAA;AACrD,EAAA,MAAM,aAAuB,EAAC;AAC9B,EAAA,MAAM,aAAuB,EAAC;AAE9B,EAAA,KAAA,MAAW,KAAK,QAAU,EAAA;AACxB,IAAI,IAAA,CAAA,CAAE,UAAW,CAAA,GAAG,CAAG,EAAA;AACrB,MAAA,UAAA,CAAW,IAAK,CAAA,CAAA,CAAE,SAAU,CAAA,CAAC,CAAC,CAAA;AAAA,KACzB,MAAA;AACL,MAAA,UAAA,CAAW,KAAK,CAAC,CAAA;AAAA;AACnB;AAGF,EAAO,OAAA,EAAE,YAAY,UAAW,EAAA;AAClC;AAEA,SAAS,eAAe,OAAiB,EAAA;AACvC,EAAA,MAAM,EAAE,UAAY,EAAA,iBAAA,EAAmB,YAAY,iBAAkB,EAAA,GAAI,mBAAmB,OAAO,CAAA;AAEnG,EAAA,MAAM,aAAuB,iBAAkB,CAAA,GAAA,CAAI,CAAK,CAAA,KAAA,cAAA,CAAe,CAAC,CAAC,CAAA;AACzE,EAAA,MAAM,aAAuB,iBAAkB,CAAA,GAAA,CAAI,CAAK,CAAA,KAAA,cAAA,CAAe,CAAC,CAAC,CAAA;AAGzE,EAAA,IAAI,UAAW,CAAA,MAAA,KAAW,CAAK,IAAA,UAAA,CAAW,SAAS,CAAG,EAAA;AACpD,IAAA,UAAA,CAAW,KAAK,IAAI,CAAA;AAAA;AAGtB,EAAO,OAAA;AAAA,IACL,IAAA,EAAM,CAAC,IAAiB,KAAA;AAEtB,MAAA,MAAM,mBAAmB,UAAW,CAAA,IAAA,CAAK,WAAS,KAAM,CAAA,IAAA,CAAK,IAAI,CAAC,CAAA;AAClE,MAAI,IAAA,CAAC,kBAAyB,OAAA,KAAA;AAG9B,MAAA,MAAM,mBAAmB,UAAW,CAAA,IAAA,CAAK,WAAS,KAAM,CAAA,IAAA,CAAK,IAAI,CAAC,CAAA;AAGlE,MAAA,OAAO,CAAC,gBAAA;AAAA;AACV,GACF;AACF;AAEA,SAAS,eAAe,OAAyB,EAAA;AAC/C,EAAA,IAAI,GAAM,GAAA,EAAA;AACV,EAAM,MAAA,KAAA,GAAQ,OAAQ,CAAA,KAAA,CAAM,GAAG,CAAA;AAE/B,EAAA,KAAA,IAAS,CAAI,GAAA,CAAA,EAAG,CAAI,GAAA,KAAA,CAAM,QAAQ,CAAK,EAAA,EAAA;AACrC,IAAA,IAAI,IAAI,CAAG,EAAA;AACT,MAAO,GAAA,IAAA,IAAA;AAAA;AAGT,IAAA,GAAA,IAAO,MAAM,CAAC,CAAA;AAAA;AAGhB,EAAO,OAAA,IAAI,OAAO,GAAG,CAAA;AACvB;AAEA,SAAS,aAAA,CAAc,eAAwB,YAA+B,EAAA;AAC5E,EAAI,IAAA,CAAC,aAAiB,IAAA,CAAC,YAAc,EAAA;AACnC,IAAO,OAAA,GAAA;AAAA;AAGT,EAAA,IAAI,CAAC,aAAe,EAAA;AAClB,IAAO,OAAA,YAAA;AAAA;AAGT,EAAA,IAAI,CAAC,YAAc,EAAA;AACjB,IAAO,OAAA,aAAA;AAAA;AAGT,EAAM,MAAA,MAAA,GAAS,mBAAmB,aAAa,CAAA;AAC/C,EAAM,MAAA,KAAA,GAAQ,mBAAmB,YAAY,CAAA;AAG7C,EAAA,IAAI,aAAgB,GAAA,CAAC,mBAAG,IAAI,GAAI,CAAA,CAAC,GAAG,MAAA,CAAO,UAAY,EAAA,GAAG,KAAM,CAAA,UAAU,CAAC,CAAC,CAAA;AAG5E,EAAI,IAAA,aAAA,CAAc,WAAW,CAAG,EAAA;AAC9B,IAAA,aAAA,GAAgB,CAAC,GAAG,CAAA;AAAA;AAItB,EAAA,MAAM,sBAAsB,aAAc,CAAA,QAAA,CAAS,GAAG,CAAI,GAAA,CAAC,GAAG,CAAI,GAAA,aAAA;AAGlE,EAAA,MAAM,aAAgB,GAAA,CAAC,mBAAG,IAAI,GAAI,CAAA,CAAC,GAAG,MAAA,CAAO,UAAY,EAAA,GAAG,KAAM,CAAA,UAAU,CAAC,CAAC,CAAA;AAG9E,EAAA,MAAM,gBAAmB,GAAA,mBAAA;AACzB,EAAA,MAAM,gBAAmB,GAAA,aAAA,CAAc,GAAI,CAAA,CAAA,CAAA,KAAK,MAAM,CAAC,CAAA;AACvD,EAAA,MAAM,WAAc,GAAA,CAAC,GAAG,gBAAA,EAAkB,GAAG,gBAAgB,CAAA;AAE7D,EAAO,OAAA,WAAA,CAAY,KAAK,GAAG,CAAA;AAC7B;AAEA,SAAS,cAAc,KAAsC,EAAA;AAC3D,EAAM,MAAA,KAAA,GAAQ,OAAO,WAAY,EAAA;AACjC,EAAA,QAAQ,KAAO;AAAA,IACb,KAAK,OAAA;AAAA,IACL,KAAK,MAAA;AAAA,IACL,KAAK,MAAA;AAAA,IACL,KAAK,OAAA;AAAA,IACL,KAAK,OAAA;AACH,MAAO,OAAA,KAAA;AAAA,IACT;AACE,MAAO,OAAA,MAAA;AAAA;AAEb","file":"console.mjs","sourcesContent":["import { ANSI } from './ansi';\nimport { ILogger, ILoggerOptions, LogLevel } from './logger';\n\nexport class ConsoleLogger implements ILogger {\n  readonly loggerOptions: ILoggerOptions;\n\n  protected readonly name: string;\n  protected readonly level: LogLevel;\n\n  private readonly _enabled: boolean;\n  private readonly _levels = {\n    error: 100,\n    warn: 200,\n    info: 300,\n    debug: 400,\n    trace: 500,\n  };\n\n  private readonly _colors = {\n    error: ANSI.ForegroundRed,\n    warn: ANSI.ForegroundYellow,\n    info: ANSI.ForegroundCyan,\n    debug: ANSI.ForegroundMagenta,\n    trace: ANSI.BackgroundBlue\n  };\n\n  constructor(name: string, options?: ILoggerOptions) {\n    this.name = name;\n\n    const env = typeof process === 'undefined' ? undefined : process.env;\n    const logNamePattern = env?.LOG || options?.pattern || '*';\n    this._enabled = parseMagicExpr(logNamePattern).test(name);\n    this.level = parseLogLevel(env?.LOG_LEVEL) || options?.level || 'info';\n    this.loggerOptions = options ?? {\n      level: this.level,\n      pattern: logNamePattern,\n    };\n  }\n\n  error(...msg: any[]) {\n    this.log('error', ...msg);\n  }\n\n  warn(...msg: any[]) {\n    this.log('warn', ...msg);\n  }\n\n  info(...msg: any[]) {\n    this.log('info', ...msg);\n  }\n\n  debug(...msg: any[]) {\n    this.log('debug', ...msg);\n  }\n\n  trace(...msg: any[]) {\n    this.log('trace', ...msg);\n  }\n\n  log(level: LogLevel, ...msg: any[]) {\n    if (!this._enabled) {\n      return;\n    }\n\n    if (this._levels[level] > this._levels[this.level]) {\n      return;\n    }\n\n    const prefix = [this._colors[level], ANSI.Bold, `[${level.toUpperCase()}]`];\n    const name = [this.name, ANSI.ForegroundReset, ANSI.BoldReset];\n\n    for (const m of msg) {\n      let text = new String(m);\n\n      if (typeof m === 'object') {\n        text = JSON.stringify(m, null, 2);\n      }\n\n      for (const line of text.split('\\n')) {\n        console[level](prefix.join(''), name.join(''), line);\n      }\n    }\n  }\n\n  child(name: string, overrideOptions?: ILoggerOptions) {\n    const mergedPattern = mergePatterns(\n      this.loggerOptions.pattern,\n      overrideOptions?.pattern\n    );\n\n    return new ConsoleLogger(`${this.name}/${name}`, {\n      ...this.loggerOptions,\n      ...overrideOptions,\n      pattern: mergedPattern\n    });\n  }\n}\n\nfunction parsePatternString(pattern: string): { inclusions: string[]; exclusions: string[] } {\n  const patterns = pattern.split(',').map(p => p.trim());\n  const inclusions: string[] = [];\n  const exclusions: string[] = [];\n\n  for (const p of patterns) {\n    if (p.startsWith('-')) {\n      exclusions.push(p.substring(1));\n    } else {\n      inclusions.push(p);\n    }\n  }\n\n  return { inclusions, exclusions };\n}\n\nfunction parseMagicExpr(pattern: string) {\n  const { inclusions: inclusionPatterns, exclusions: exclusionPatterns } = parsePatternString(pattern);\n\n  const inclusions: RegExp[] = inclusionPatterns.map(p => patternToRegex(p));\n  const exclusions: RegExp[] = exclusionPatterns.map(p => patternToRegex(p));\n\n  // If only exclusions specified, implicitly include everything\n  if (inclusions.length === 0 && exclusions.length > 0) {\n    inclusions.push(/.*/);\n  }\n\n  return {\n    test: (name: string) => {\n      // Check if name matches any inclusion pattern\n      const matchesInclusion = inclusions.some(regex => regex.test(name));\n      if (!matchesInclusion) return false;\n\n      // Check if name matches any exclusion pattern\n      const matchesExclusion = exclusions.some(regex => regex.test(name));\n\n      // Must match inclusion AND not match any exclusion\n      return !matchesExclusion;\n    }\n  };\n}\n\nfunction patternToRegex(pattern: string): RegExp {\n  let res = '';\n  const parts = pattern.split('*');\n\n  for (let i = 0; i < parts.length; i++) {\n    if (i > 0) {\n      res += '.*';\n    }\n\n    res += parts[i];\n  }\n\n  return new RegExp(res);\n}\n\nfunction mergePatterns(parentPattern?: string, childPattern?: string): string {\n  if (!parentPattern && !childPattern) {\n    return '*';\n  }\n\n  if (!parentPattern) {\n    return childPattern!;\n  }\n\n  if (!childPattern) {\n    return parentPattern;\n  }\n\n  const parent = parsePatternString(parentPattern);\n  const child = parsePatternString(childPattern);\n\n  // Combine and deduplicate inclusions\n  let allInclusions = [...new Set([...parent.inclusions, ...child.inclusions])];\n\n  // If only exclusions specified, implicitly include everything\n  if (allInclusions.length === 0) {\n    allInclusions = ['*'];\n  }\n\n  // Optimize: If '*' exists, it matches everything, so remove other inclusions\n  const optimizedInclusions = allInclusions.includes('*') ? ['*'] : allInclusions;\n\n  // Combine and deduplicate exclusions\n  const allExclusions = [...new Set([...parent.exclusions, ...child.exclusions])];\n\n  // Build merged pattern: combine inclusions and exclusions\n  const inclusionStrings = optimizedInclusions;\n  const exclusionStrings = allExclusions.map(e => '-' + e);\n  const allPatterns = [...inclusionStrings, ...exclusionStrings];\n\n  return allPatterns.join(',');\n}\n\nfunction parseLogLevel(level?: string): LogLevel | undefined {\n  const value = level?.toLowerCase();\n  switch (value) {\n    case 'error':\n    case 'warn':\n    case 'info':\n    case 'debug':\n    case 'trace':\n      return value;\n    default:\n      return undefined;\n  }\n}\n"]}